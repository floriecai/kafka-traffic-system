<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CPSC 416 proj 2</title>
    <style>
      body, html { margin:0; padding:0; height:100%;}
      body { font-family:sans-serif; }
      #heatmapContainerWrapper { width:100%; height:100%; position:absolute; }
      #heatmapContainer { width:100%; height:100%;}
      h1 { position:absolute; background:black; color:white; padding:10px; font-weight:200;}
      #all-examples-info { position:absolute; background:white; font-size:16px; padding:20px; top:100px; width:350px; line-height:150%; border:1px solid rgba(0,0,0,.2);}

    </style>
  </head>
  <body>
    <div id="heatmapContainerWrapper">
      <div id="heatmapContainer">

      </div>
    </div>
    <h1>CPSC 416 proj 2</h1>
    <script src="/build/heatmap.js"></script>
    <script>
      window.onload = function() {
        // create heatmap instance
        var heatmap = h337.create({
          container: document.getElementById('heatmapContainer'),
          maxOpacity: .6,
          radius: 50,
          blur: .90
        });

        // boundaries for data generation
        var width = (+window.getComputedStyle(document.body).width.replace(/px/,''));
        var height = (+window.getComputedStyle(document.body).height.replace(/px/,''));

        var addDatum = function(x, y) {
          var c = 30;
          heatmap.addData({ x: x, y:y, value: c});
        };

        // this generates new datapoints in a kind of random timing
        setTimeout(function test() {
          var xhttp;
          xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              console.log(this.responseText);
              var lines = this.responseText.split('\n');
              for (var i = 0; i < lines.length; i++) {
                line = lines[i];
                if (line === 'done')
                  return;

                var info = line.split(' ');
                x = parseFloat(info[0]);
                y = parseFloat(info[1]);
                addDatum(x,y);
              }
            }
          }

          xhttp.open("GET", "heatmapdata", true);
          xhttp.send();

          setTimeout(test, 100);
        }, 100);
      };
    </script>
  </body>
</html>
